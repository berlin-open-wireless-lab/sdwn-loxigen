// Copyright 2013, Big Switch Networks, Inc.
//
// LoxiGen is licensed under the Eclipse Public License, version 1.0 (EPL), with
// the following special exception:
//
// LOXI Exception
//
// As a special exception to the terms of the EPL, you may distribute libraries
// generated by LoxiGen (LoxiGen Libraries) under the terms of your choice, provided
// that copyright and licensing notices generated by LoxiGen are not altered or removed
// from the LoxiGen Libraries and the notice provided below is (i) included in
// the LoxiGen Libraries, if distributed in source code form and (ii) included in any
// documentation for the LoxiGen Libraries, if distributed in binary form.
//
// Notice: "Copyright 2013, Big Switch Networks, Inc. This library was generated by the LoxiGen Compiler."
//
// You may not use this file except in compliance with the EPL or LOXI Exception. You may obtain
// a copy of the EPL at:
//
// http://www.eclipse.org/legal/epl-v10.html
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
// WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
// EPL for the specific language governing permissions and limitations
// under the EPL.

#version 4

//This message is sent by the middle box when a new client has connected
//or as a command to add a new sta on a vlap of a physical AP.
struct of_wifi_add_sta : of_wifi_header {
    uint8_t version;
    uint8_t type == 4;
    uint16_t length;
    uint32_t xid;
    uint32_t experimenter == 0x421337;
    uint32_t subtype == 1;
    of_mac_addr_t sta; //MAC address of the client
    of_mac_addr_t ap; //bssid of the access point
    uint16_t capabilities; //"capabilities" field from IEEE 802.11
    uint16_t aid; //association ID
    of_desc_str_t supported_rates; //list of supported rates, as used in kernel
    of_desc_str_t ht_capabilities; //vector of HT-capabilities, if any
    list(of_bsn_tlv_data_t) keys; //cryptographic keys, is aplicable
};

//remove a sta from a vlap.
//vlap and sta are identified by its mac addresses.
struct of_wifi_del_sta : of_wifi_header {
    uint8_t version;
    uint8_t type == 4;
    uint16_t length;
    uint32_t xid;
    uint32_t experimenter == 0x421337;
    uint32_t subtype == 4;
    of_mac_addr_t sta; // client mac address
    of_mac_addr_t ap; // access point mac address
};

//packet type used to transfer a wifi frame with radiotap header
//to the controller. like of_packet_in
struct of_wifi_packet_in : of_wifi_header {
    uint8_t version;
    uint8_t type == 4;
    uint16_t length;
    uint32_t xid;
    uint32_t experimenter == 0x421337;
    uint32_t subtype == 2;
    uint8_t hdr_version_type;
    uint8_t hdr_flags;
    uint16_t hdr_duration;
    of_mac_addr_t hdr_addr1; // address1 of the IEEE 802.11 frame format
    of_mac_addr_t hdr_addr2; // address2 of the IEEE 802.11 frame format
    of_mac_addr_t hdr_addr3; // address3 of the IEEE 802.11 frame format
    uint16_t hdr_seq_ctrl;   // repitition of data from the header
    of_mac_addr_t hdr_addr4; // address4 of the IEEE 802.11 frame format
    of_octets_t frame; // the actual data
                       // includes repitition of the previous fields
};

//instanciates a new vlap instance on a physical AP
//TODO: needs more properties
struct of_wifi_add_vlap : of_wifi_header {
    uint8_t version;
    uint8_t type == 4;
    uint16_t length;
    uint32_t xid;
    uint32_t experimenter == 0x421337;
    uint32_t subtype == 3;
    of_mac_addr_t bssid; // BSSID of the vlap to be created
    of_octets_t beacon; //beacon frame associated with that vlap. not used.
};

//removed an exisitng vlap instance on a physical AP
struct of_wifi_del_vlap : of_wifi_header {
    uint8_t version;
    uint8_t type == 4;
    uint16_t length;
    uint32_t xid;
    uint32_t experimenter == 0x421337;
    uint32_t subtype == 5;
    of_mac_addr_t bssid; // BSSID of the vlap to be removed.
};

//ask for port at which this agent of connected
//TODO: could probably be replaced with LLDP
struct of_wifi_get_remote_port_request : of_wifi_header {
    uint8_t version;
    uint8_t type == 4;
    uint16_t length;
    uint32_t xid;
    uint32_t experimenter == 0x421337;
    uint32_t subtype == 6;
};

//reply the port number where this agent is connected
struct of_wifi_get_remote_port_reply : of_wifi_header {
    uint8_t version;
    uint8_t type == 4;
    uint16_t length;
    uint32_t xid;
    uint32_t experimenter == 0x421337;
    uint32_t subtype == 7;
    of_port_no_t port; // the port number
};

//request a list of all connected sta to a given bssid
//applies only to middle box
struct of_wifi_get_stas_request : of_wifi_stats_request {
    uint8_t version;
    uint8_t type == 18;
    uint16_t length;
    uint32_t xid;
    uint16_t stats_type == 0xffff;
    enum ofp_stats_request_flags flags;
    pad(4);
    uint32_t experimenter == 0x421337;
    uint32_t subtype == 1;
    of_mac_addr_t bssid;
};

//reply a list of connected sta (or empty list)
struct of_wifi_get_stas_reply : of_wifi_stats_reply {
    uint8_t version;
    uint8_t type == 19;
    uint16_t length;
    uint32_t xid;
    uint16_t stats_type == 0xffff;
    enum ofp_stats_reply_flags flags;
    pad(4);
    uint32_t experimenter == 0x421337;
    uint32_t subtype == 1;
    list(of_wifi_stas_entry_t) stas;
};

//entry describing a single connected sta
struct of_wifi_stas_entry {
    uint16_t length;
    of_mac_addr_t mac;
    uint16_t capabilities; //fields as in of_wifi_add_sta
    uint16_t aid;
    of_desc_str_t supported_rates;
    of_desc_str_t ht_capabilities;
    list(of_bsn_tlv_data_t) keys;
};
